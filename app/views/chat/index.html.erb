<!-- Ï±ÑÌåÖ Î©îÏù∏ ÌéòÏù¥ÏßÄ -->
<div class="chat-container">
  <!-- ÏÉÅÎã® Ìó§Îçî -->
  <div class="chat-header">
    <div class="header-left">
      <div class="app-logo-small">
        <span class="star-icon">‚≠ê</span>
      </div>
      <div class="header-info">
        <h2 class="chat-title">Î≥ÑÎùºÏ±ÑÌåÖ</h2>
        <span class="online-status">‚óè Ïò®ÎùºÏù∏</span>
      </div>
    </div>
    
    <div class="header-right">
      <span class="current-user"><%= current_user %></span>
      <%= button_to "Î°úÍ∑∏ÏïÑÏõÉ", logout_path, method: :delete, class: "btn-logout" %>
    </div>
  </div>
  
  <!-- Î©îÏãúÏßÄ ÏòÅÏó≠ -->
  <div class="messages-container" id="messages">
    <% 
      # ÏöîÏùº Í≥ÑÏÇ∞Ïö©
      weekdays = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†']
      last_date = nil
    %>
    
    <% @messages.each_with_index do |message, index| %>
      <% current_date = message.created_at.to_date %>
      
      <!-- ÎÇ†ÏßúÍ∞Ä Î∞îÎÄåÎ©¥ ÎÇ†Ïßú Íµ¨Î∂ÑÏÑ† ÌëúÏãú -->
      <% if last_date != current_date %>
        <div class="date-divider" data-date="<%= current_date %>">
          <span class="date-divider-text">
            <% if current_date == Date.today %>
              Ïò§Îäò
            <% elsif current_date == Date.today - 1 %>
              Ïñ¥Ï†ú
            <% else %>
              <%= current_date.strftime("#{current_date.month}Ïõî #{current_date.day}Ïùº (#{weekdays[current_date.wday]})") %>
            <% end %>
          </span>
        </div>
        <% last_date = current_date %>
      <% end %>
      
      <!-- Î©îÏãúÏßÄ -->
      <div class="message <%= 'message-mine' if message.username == current_user %>" data-message-id="<%= message.id %>" data-date="<%= current_date %>">
        <div class="message-bubble-wrapper">
          <div class="message-content-wrapper">
            <div class="message-content">
              <%= message.content %>
            </div>
          </div>
          <div class="message-info">
            <% if message.username == current_user %>
              <!-- ÎÇ¥Í∞Ä Î≥¥ÎÇ∏ Î©îÏãúÏßÄ: ÏùΩÏùå ÌëúÏãú + ÏãúÍ∞Ñ -->
              <span class="read-status" data-read-count="<%= message.read_count_except_sender %>">
                <% if message.read_count_except_sender == 0 %>
                  <span class="checkmark single">‚úì</span>
                <% else %>
                  <span class="checkmark double">‚úì‚úì</span>
                <% end %>
              </span>
            <% end %>
            <span class="message-time"><%= message.created_at.strftime("%H:%M") %></span>
          </div>
        </div>
      </div>
    <% end %>
  </div>
  
  <!-- Î©îÏãúÏßÄ ÏûÖÎ†• ÏòÅÏó≠ -->
  <div class="message-input-container">
    <form id="message-form" class="message-form">
      <!-- Ïù¥Î™®Ìã∞ÏΩò Î≤ÑÌäº -->
      <button type="button" id="emoji-button" class="btn-emoji" title="Ïù¥Î™®Ìã∞ÏΩò">
        üòä
      </button>
      
      <!-- Î©îÏãúÏßÄ ÏûÖÎ†•Ï∞Ω -->
      <input 
        type="text" 
        id="message-input" 
        class="message-input" 
        placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." 
        autocomplete="off"
        required>
      
      <!-- Ï†ÑÏÜ° Î≤ÑÌäº -->
      <button type="submit" class="btn-send" title="Ï†ÑÏÜ°">
        <!-- Ï†ÑÏÜ° ÏïÑÏù¥ÏΩò -->
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </form>
    
    <!-- Ïù¥Î™®Ìã∞ÏΩò ÌîºÏª§ -->
    <div id="emoji-picker" class="emoji-picker" style="display: none;">
      <div class="emoji-picker-header">
        <span class="emoji-category">ÏûêÏ£º ÏÇ¨Ïö©</span>
      </div>
      <div class="emoji-grid" id="emoji-grid">
        <!-- JavaScriptÎ°ú Ïù¥Î™®Ìã∞ÏΩò Ï∂îÍ∞Ä -->
      </div>
    </div>
  </div>
</div>

<!-- JavaScriptÎ°ú ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê Ïù¥Î¶Ñ Ï†ÑÎã¨ -->
<script>
  window.currentUser = "<%= current_user %>";
</script>
